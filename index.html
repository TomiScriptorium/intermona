<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Intermona - Organizaci√≥n M√©dica</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Font Awesome Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Patrick+Hand&display=swap" rel="stylesheet">

    <style>
        body {
            font-family: 'Nunito', sans-serif;
            background-color: #f3f4f6;
            -webkit-tap-highlight-color: transparent;
        }
        
        .font-handwriting {
            font-family: 'Patrick Hand', cursive;
            font-size: 1.1rem;
        }

        .hide-scrollbar::-webkit-scrollbar { display: none; }
        .hide-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }

        /* Animaciones */
        .view-transition {
            animation: fadeIn 0.3s ease-out;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(5px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .item-enter {
            animation: slideIn 0.3s ease-out forwards;
        }

        .item-leave {
            transition: all 0.3s ease-in;
            opacity: 0;
            transform: translateX(20px);
            height: 0 !important;
            margin: 0 !important;
            padding: 0 !important;
            overflow: hidden;
        }

        .calendar-day { aspect-ratio: 1/1; }
        body.modal-open { overflow: hidden; }
        .pb-safe { padding-bottom: env(safe-area-inset-bottom); }
    </style>
</head>
<body class="text-gray-800 h-screen flex flex-col overflow-hidden">

    <!-- Header -->
    <header class="bg-pink-600 text-white p-4 shadow-md flex justify-between items-center z-20 shrink-0">
        <div class="flex items-center gap-2 cursor-pointer" onclick="renderView('dashboard')">
            <i class="fa-solid fa-user-doctor text-2xl"></i>
            <h1 class="text-xl font-bold tracking-wide">Intermona</h1>
        </div>
        <button onclick="exportData()" class="text-xs bg-pink-700 px-3 py-1 rounded hover:bg-pink-800 transition shadow-sm active:scale-95 transform" title="Copiar datos">
            <i class="fa-solid fa-cloud-arrow-down mr-1"></i> Backup
        </button>
    </header>

    <!-- Main Container -->
    <main id="app-container" class="flex-1 overflow-y-auto p-4 pb-24 relative bg-gray-50 scroll-smooth">
        <!-- Renderizado din√°mico -->
    </main>

    <!-- Nav Bar -->
    <nav class="fixed bottom-0 w-full bg-white shadow-[0_-2px_10px_rgba(0,0,0,0.05)] border-t border-gray-100 z-30 pb-safe">
        <div class="flex justify-around items-center h-16">
            <button onclick="renderView('dashboard')" class="nav-btn flex flex-col items-center justify-center w-full h-full text-gray-400 hover:text-pink-600 transition-colors" data-target="dashboard">
                <i class="fa-solid fa-house text-xl mb-1 transition-transform"></i>
                <span class="text-[10px] font-semibold">Inicio</span>
            </button>
            <button onclick="renderView('todo')" class="nav-btn flex flex-col items-center justify-center w-full h-full text-gray-400 hover:text-pink-600 transition-colors" data-target="todo">
                <i class="fa-solid fa-check-double text-xl mb-1 transition-transform"></i>
                <span class="text-[10px] font-semibold">Tareas</span>
            </button>
            <button onclick="renderView('turnario')" class="nav-btn flex flex-col items-center justify-center w-full h-full text-gray-400 hover:text-pink-600 transition-colors" data-target="turnario">
                <i class="fa-solid fa-calendar-days text-xl mb-1 transition-transform"></i>
                <span class="text-[10px] font-semibold">Turnario</span>
            </button>
            <button onclick="renderView('notes')" class="nav-btn flex flex-col items-center justify-center w-full h-full text-gray-400 hover:text-pink-600 transition-colors" data-target="notes">
                <i class="fa-solid fa-sticky-note text-xl mb-1 transition-transform"></i>
                <span class="text-[10px] font-semibold">Notas</span>
            </button>
            <button onclick="renderView('links')" class="nav-btn flex flex-col items-center justify-center w-full h-full text-gray-400 hover:text-pink-600 transition-colors" data-target="links">
                <i class="fa-solid fa-link text-xl mb-1 transition-transform"></i>
                <span class="text-[10px] font-semibold">Links</span>
            </button>
        </div>
    </nav>

    <!-- Modal Turnario -->
    <div id="shift-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4 backdrop-blur-sm transition-opacity">
        <div class="bg-white rounded-xl shadow-2xl w-full max-w-sm p-6 transform transition-all scale-100">
            <div class="flex justify-between items-center mb-4 border-b pb-2">
                <h3 id="modal-date-title" class="text-lg font-bold text-gray-700">Editar Fecha</h3>
                <button onclick="closeModal()" class="text-gray-400 hover:text-gray-600"><i class="fa-solid fa-xmark text-xl"></i></button>
            </div>
            
            <label class="block text-sm font-bold text-gray-600 mb-2 uppercase tracking-wide text-xs">Tipo de Turno:</label>
            <div class="grid grid-cols-2 gap-2 mb-4">
                <button onclick="setShiftType('guardia')" data-type="guardia" class="shift-type-btn p-2 rounded-lg bg-red-50 text-red-600 hover:bg-red-100 border border-red-100 font-semibold text-sm transition-all duration-200 flex items-center justify-center gap-2"><i class="fa-solid fa-bell"></i> Guardia 24h</button>
                <button onclick="setShiftType('dia')" data-type="dia" class="shift-type-btn p-2 rounded-lg bg-blue-50 text-blue-600 hover:bg-blue-100 border border-blue-100 font-semibold text-sm transition-all duration-200 flex items-center justify-center gap-2"><i class="fa-solid fa-sun"></i> Turno D√≠a</button>
                <button onclick="setShiftType('noche')" data-type="noche" class="shift-type-btn p-2 rounded-lg bg-indigo-50 text-indigo-600 hover:bg-indigo-100 border border-indigo-100 font-semibold text-sm transition-all duration-200 flex items-center justify-center gap-2"><i class="fa-solid fa-moon"></i> Turno Noche</button>
                <button onclick="setShiftType('post')" data-type="post" class="shift-type-btn p-2 rounded-lg bg-orange-50 text-orange-600 hover:bg-orange-100 border border-orange-100 font-semibold text-sm transition-all duration-200 flex items-center justify-center gap-2"><i class="fa-solid fa-bed"></i> Post-G</button>
                <button onclick="setShiftType('libre')" data-type="libre" class="shift-type-btn p-2 rounded-lg bg-green-50 text-green-600 hover:bg-green-100 border border-green-100 font-semibold text-sm transition-all duration-200 flex items-center justify-center gap-2"><i class="fa-solid fa-mug-hot"></i> Libre</button>
                <button onclick="setShiftType(null)" data-type="null" class="shift-type-btn p-2 rounded-lg bg-gray-50 text-gray-500 hover:bg-gray-100 border border-gray-200 font-semibold text-sm transition-all duration-200 flex items-center justify-center gap-2"><i class="fa-solid fa-trash-can"></i> Borrar</button>
            </div>

            <label class="block text-sm font-bold text-gray-600 mb-2 uppercase tracking-wide text-xs">Nota del d√≠a:</label>
            <textarea id="modal-note-input" class="w-full p-3 border border-gray-200 rounded-lg focus:ring-2 focus:ring-pink-500 outline-none text-sm resize-none bg-gray-50" rows="3" placeholder="Ej: Examen final..."></textarea>

            <div class="flex justify-end mt-6 gap-3">
                <button onclick="closeModal()" class="px-4 py-2 text-gray-500 hover:bg-gray-100 rounded-lg font-medium">Cancelar</button>
                <button onclick="saveShift()" class="px-6 py-2 bg-pink-600 text-white rounded-lg hover:bg-pink-700 shadow-lg transform active:scale-95 transition-all font-bold">Guardar</button>
            </div>
        </div>
    </div>

    <!-- Modal Confirmaci√≥n -->
    <div id="confirm-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-[60] flex items-center justify-center p-4 backdrop-blur-sm">
        <div class="bg-white rounded-xl shadow-2xl w-full max-w-xs p-6 text-center transform transition-all scale-100">
            <div class="w-12 h-12 bg-red-100 text-red-500 rounded-full flex items-center justify-center mx-auto mb-4">
                <i class="fa-solid fa-triangle-exclamation text-xl"></i>
            </div>
            <h3 class="text-lg font-bold text-gray-800 mb-2">¬øEst√°s seguro?</h3>
            <p id="confirm-message" class="text-sm text-gray-500 mb-6">Esta acci√≥n no se puede deshacer.</p>
            <div class="flex justify-center gap-3">
                <button onclick="closeConfirmModal()" class="px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 font-medium">Cancelar</button>
                <button id="confirm-btn-action" class="px-4 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600 font-medium shadow-md">Eliminar</button>
            </div>
        </div>
    </div>

    <!-- Modal Nueva Carpeta -->
    <div id="folder-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-[60] flex items-center justify-center p-4 backdrop-blur-sm">
        <div class="bg-white rounded-xl shadow-2xl w-full max-w-xs p-6 transform transition-all scale-100">
            <h3 class="text-lg font-bold text-gray-800 mb-4">Nueva Carpeta</h3>
            <input type="text" id="new-folder-name" class="w-full p-3 border border-gray-200 rounded-lg mb-4 focus:ring-2 focus:ring-pink-500 outline-none" placeholder="Nombre (ej. Cardiolog√≠a)">
            <div class="flex justify-end gap-3">
                <button onclick="closeFolderModal()" class="px-4 py-2 text-gray-500 hover:bg-gray-100 rounded-lg">Cancelar</button>
                <button onclick="createFolder()" class="px-4 py-2 bg-pink-600 text-white rounded-lg hover:bg-pink-700 font-bold">Crear</button>
            </div>
        </div>
    </div>

    <!-- Toast -->
    <div id="toast" class="fixed top-24 left-1/2 transform -translate-x-1/2 bg-gray-800/90 backdrop-blur text-white px-6 py-3 rounded-full shadow-xl opacity-0 transition-all duration-300 pointer-events-none z-[70] flex items-center gap-2 text-sm font-medium translate-y-2">
        <i class="fa-solid fa-info-circle"></i> <span id="toast-msg">Mensaje</span>
    </div>

    <script>
        const APP_KEY = 'intermona_data_v2'; 
        let state = {
            view: 'dashboard', 
            todos: [],
            notes: [],
            folders: [],
            links: [],
            shifts: {},
            currentDate: new Date(),
            currentFolderId: 'all',
            editingNoteId: null
        };

        function init() {
            loadData();
            renderView(state.view);
        }

        function loadData() {
            const saved = localStorage.getItem(APP_KEY);
            const savedOld = localStorage.getItem('intermona_data_v1');
            
            if (saved) {
                try {
                    const parsed = JSON.parse(saved);
                    state = { ...state, ...parsed, currentDate: new Date() }; 
                } catch (e) { console.error("Error data", e); }
            } else if (savedOld) {
                try {
                    const parsedOld = JSON.parse(savedOld);
                    state = { ...state, ...parsedOld, currentDate: new Date() };
                    state.folders = [{id: 'general', name: 'General'}];
                    state.notes = state.notes.map(n => ({...n, folderId: 'general'}));
                    saveData();
                    showToast("Datos actualizados a v2", "fa-circle-up");
                } catch(e) {}
            } else {
                state.folders = [{id: 'general', name: 'General'}];
                state.todos = [{ id: 1, text: "Bienvenido a Intermona", done: false }];
            }

            if (!state.folders || state.folders.length === 0) {
                state.folders = [{id: 'general', name: 'General'}];
            }
        }

        function saveData() {
            const toSave = { ...state };
            delete toSave.currentDate; 
            delete toSave.editingNoteId; 
            localStorage.setItem(APP_KEY, JSON.stringify(toSave));
        }

        function showToast(msg, icon = 'fa-info-circle') {
            const toast = document.getElementById('toast');
            document.getElementById('toast-msg').innerText = msg;
            toast.querySelector('i').className = `fa-solid ${icon}`;
            toast.classList.remove('opacity-0', 'translate-y-2');
            toast.classList.add('translate-y-0');
            setTimeout(() => {
                toast.classList.add('opacity-0', 'translate-y-2');
                toast.classList.remove('translate-y-0');
            }, 3000);
        }

        function exportData() {
            const textArea = document.createElement("textarea");
            textArea.value = localStorage.getItem(APP_KEY);
            textArea.style.position = "fixed"; 
            textArea.style.left = "-9999px";
            document.body.appendChild(textArea);
            textArea.select();
            try {
                if(document.execCommand('copy')) showToast("Copia realizada", "fa-check-circle");
                else showToast("Error al copiar", "fa-times");
            } catch (err) {
                showToast("Error al copiar", "fa-times");
            }
            document.body.removeChild(textArea);
        }

        // --- CORE RENDER SYSTEM ---
        function renderView(viewName) {
            // Solo reseteamos la edici√≥n si cambiamos de secci√≥n, no si recargamos la misma (ej. al editar)
            if (viewName !== 'notes') {
                state.editingNoteId = null;
            }
            
            state.view = viewName;
            
            document.querySelectorAll('.nav-btn').forEach(btn => {
                const icon = btn.querySelector('i');
                if(btn.dataset.target === viewName) {
                    btn.classList.remove('text-gray-400');
                    btn.classList.add('text-pink-600');
                    icon.classList.add('scale-110');
                } else {
                    btn.classList.add('text-gray-400');
                    btn.classList.remove('text-pink-600');
                    icon.classList.remove('scale-110');
                }
            });

            const container = document.getElementById('app-container');
            container.innerHTML = ''; 
            container.scrollTop = 0;

            const wrapper = document.createElement('div');
            wrapper.className = "view-transition max-w-lg mx-auto";
            
            switch(viewName) {
                case 'dashboard': wrapper.innerHTML = getDashboardHTML(); break;
                case 'turnario': wrapper.innerHTML = getTurnarioHTML(); break;
                case 'todo': wrapper.innerHTML = getTodoHTML(); break;
                case 'notes': wrapper.innerHTML = getNotesHTML(); break;
                case 'links': wrapper.innerHTML = getLinksHTML(); break;
            }
            
            container.appendChild(wrapper);
            
            if (viewName === 'notes') {
                const imgInput = document.getElementById('new-note-image');
                if(imgInput) imgInput.addEventListener('change', function() { previewImage(this); });
            }
            
            saveData();
        }

        // --- DASHBOARD ---
        function getDashboardHTML() {
            const today = new Date();
            const dateKey = today.toISOString().split('T')[0];
            let shift = state.shifts[dateKey];
            let isNextShift = false;
            let daysUntil = 0;
            let nextDateStr = "";

            if (!shift) {
                const futureDates = Object.keys(state.shifts).filter(date => date > dateKey).sort();
                if (futureDates.length > 0) {
                    const nextDateKey = futureDates[0];
                    shift = state.shifts[nextDateKey];
                    isNextShift = true;
                    const diffTime = Math.abs(new Date(nextDateKey) - new Date(dateKey));
                    daysUntil = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                    const [y, m, d] = nextDateKey.split('-').map(Number);
                    nextDateStr = new Date(y, m - 1, d).toLocaleDateString('es-ES', { weekday: 'long', day: 'numeric', month: 'long' });
                }
            }

            const pendingTodos = state.todos.filter(t => !t.done);
            const hour = today.getHours();
            let greeting = hour < 12 ? "Buenos d√≠as ‚òÄÔ∏è" : hour < 20 ? "Buenas tardes üå§Ô∏è" : "Buenas noches üåô";

            let shiftCardClass = "bg-white border-gray-200 text-gray-600";
            let shiftText = "No hay turnos pr√≥ximos";
            let shiftIcon = "fa-calendar-check"; 
            let cardIconColor = "text-gray-300";

            if (shift) {
                if (shift.type === 'guardia') { shiftCardClass = "bg-gradient-to-br from-red-500 to-red-600 text-white border-red-600 shadow-red-200"; shiftText = "Guardia 24h"; shiftIcon = "fa-truck-medical"; cardIconColor = "text-white/30"; }
                else if (shift.type === 'dia') { shiftCardClass = "bg-gradient-to-br from-blue-500 to-blue-600 text-white border-blue-600 shadow-blue-200"; shiftText = "Turno de D√≠a"; shiftIcon = "fa-sun"; cardIconColor = "text-white/30"; }
                else if (shift.type === 'noche') { shiftCardClass = "bg-gradient-to-br from-indigo-600 to-indigo-700 text-white border-indigo-700 shadow-indigo-200"; shiftText = "Turno de Noche"; shiftIcon = "fa-moon"; cardIconColor = "text-white/30"; }
                else if (shift.type === 'post') { shiftCardClass = "bg-gradient-to-br from-orange-400 to-orange-500 text-white border-orange-500 shadow-orange-200"; shiftText = "Post-Guardia"; shiftIcon = "fa-bed"; cardIconColor = "text-white/30"; }
                else if (shift.type === 'libre') { shiftCardClass = "bg-gradient-to-br from-green-500 to-green-600 text-white border-green-600 shadow-green-200"; shiftText = "D√≠a Libre"; shiftIcon = "fa-mug-hot"; cardIconColor = "text-white/30"; }

                if (isNextShift && shift.type !== 'libre') {
                     shiftCardClass = "bg-white border-l-4 border-l-" + (shift.type === 'guardia' ? 'red' : shift.type === 'dia' ? 'blue' : shift.type === 'noche' ? 'indigo' : 'orange') + "-500 border-gray-200 text-gray-700";
                     cardIconColor = (shift.type === 'guardia' ? 'text-red' : shift.type === 'dia' ? 'text-blue' : shift.type === 'noche' ? 'text-indigo' : 'text-orange') + "-100";
                     shiftText = `<span class="text-${shift.type === 'guardia' ? 'red' : shift.type === 'dia' ? 'blue' : 'indigo'}-600 font-bold">${shiftText}</span>`;
                }
            }

            return `
                <div class="space-y-5">
                    <div class="flex justify-between items-end mb-2 px-1">
                        <div>
                            <h2 class="text-2xl font-bold text-gray-800">${greeting}</h2>
                            <p class="text-sm text-gray-500 capitalize">${today.toLocaleDateString('es-ES', { weekday: 'long', day: 'numeric', month: 'long' })}</p>
                        </div>
                    </div>

                    <div onclick="renderView('turnario')" class="cursor-pointer p-6 rounded-2xl shadow-lg border relative overflow-hidden ${shiftCardClass} flex items-center justify-between transition-transform transform hover:scale-[1.01] active:scale-95">
                        <div class="z-10 relative w-full">
                            <p class="text-xs font-bold uppercase tracking-wider mb-2 flex items-center gap-1 opacity-90">
                                ${isNextShift ? '<i class="fa-solid fa-clock rotate-12"></i> PR√ìXIMO' : '<i class="fa-solid fa-calendar-day"></i> HOY'} 
                                ${isNextShift ? `<span class="font-normal opacity-80">(${daysUntil} d√≠as)</span>` : ''}
                            </p>
                            <h3 class="text-2xl font-bold leading-tight">${shiftText}</h3>
                            ${isNextShift ? `<p class="text-xs mt-1 opacity-80">${nextDateStr}</p>` : ''}
                        </div>
                        <i class="fa-solid ${shiftIcon} text-6xl absolute -right-2 -bottom-4 ${cardIconColor} transform -rotate-12"></i>
                    </div>

                    <div class="bg-white p-5 rounded-2xl shadow-sm border border-gray-100">
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="font-bold text-gray-700 flex items-center gap-2">
                                <span class="bg-pink-100 text-pink-600 w-8 h-8 flex items-center justify-center rounded-lg"><i class="fa-solid fa-list-check"></i></span>
                                Pendientes <span class="bg-gray-100 text-gray-600 text-xs px-2 py-0.5 rounded-full ml-1">${pendingTodos.length}</span>
                            </h3>
                            <button onclick="renderView('todo')" class="text-xs text-pink-600 font-bold hover:underline">Ver todo</button>
                        </div>
                        ${pendingTodos.length === 0 
                            ? `<p class="text-center text-gray-400 text-sm py-2">¬°Todo al d√≠a! üéâ</p>` 
                            : `<ul class="space-y-3">
                                ${pendingTodos.slice(0, 3).map(t => `<li class="flex items-start gap-3 text-sm text-gray-600"><i class="fa-regular fa-square text-pink-500 mt-1"></i><span class="truncate pt-0.5">${t.text}</span></li>`).join('')}
                               </ul>`
                        }
                    </div>

                    <div class="grid grid-cols-2 gap-4">
                        <div onclick="renderView('notes')" class="bg-yellow-50 p-4 rounded-2xl shadow-sm border border-yellow-100 cursor-pointer hover:bg-yellow-100 transition group relative overflow-hidden">
                            <i class="fa-solid fa-note-sticky absolute -right-3 -top-3 text-6xl text-yellow-100 group-hover:text-yellow-200 transition-colors transform rotate-12"></i>
                            <h3 class="font-bold text-gray-700 text-sm mb-2 relative z-10">Notas</h3>
                            <p class="text-xs text-gray-500 relative z-10">Ver tus apuntes</p>
                        </div>
                        <div onclick="renderView('turnario')" class="bg-pink-50 p-4 rounded-2xl shadow-sm border border-pink-100 cursor-pointer hover:bg-pink-100 transition group relative overflow-hidden">
                            <i class="fa-solid fa-calendar absolute -right-3 -top-3 text-6xl text-pink-100 group-hover:text-pink-200 transition-colors transform rotate-12"></i>
                            <h3 class="font-bold text-gray-700 text-sm mb-2 relative z-10">Calendario</h3>
                            <p class="text-xs text-gray-500 relative z-10">Ver mes completo</p>
                        </div>
                    </div>
                </div>
            `;
        }

        // --- TODO LIST ---
        function getTodoHTML() {
            const todosHTML = state.todos.length === 0 
                ? getEmptyTodoHTML() 
                : state.todos.sort((a,b) => a.done - b.done).map(t => createTodoItemHTML(t)).join('');

            return `
                <div>
                    <h2 class="text-2xl font-bold text-gray-800 mb-1">Pendientes</h2>
                    <p class="text-sm text-gray-500 mb-6">Organiza tus tareas m√©dicas.</p>
                    
                    <div class="flex gap-2 mb-6 shadow-sm rounded-xl">
                        <input type="text" id="new-todo" placeholder="Nueva tarea..." 
                            class="flex-1 p-4 rounded-l-xl border border-r-0 border-gray-200 focus:outline-none focus:ring-1 focus:ring-pink-500"
                            onkeypress="if(event.key === 'Enter') addTodo()">
                        <button onclick="addTodo()" class="bg-pink-600 text-white px-5 rounded-r-xl hover:bg-pink-700 transition font-bold">
                            <i class="fa-solid fa-plus"></i>
                        </button>
                    </div>
                    <ul id="todo-list" class="space-y-3 pb-20">${todosHTML}</ul>
                </div>
            `;
        }

        function createTodoItemHTML(todo) {
            const bg = todo.done ? 'bg-gray-50' : 'bg-white';
            const text = todo.done ? 'text-gray-400 line-through' : 'text-gray-700 font-medium';
            const border = todo.done ? 'border-gray-100' : 'border-gray-200';
            const icon = todo.done ? 'fa-regular fa-square-check text-gray-400' : 'fa-regular fa-square text-pink-500 hover:text-pink-600';
            
            return `
                <li id="todo-${todo.id}" class="flex items-center gap-3 p-4 rounded-xl shadow-sm border ${border} ${bg} transition-all group item-enter">
                    <button onclick="toggleTodo(${todo.id})" class="text-xl focus:outline-none transform active:scale-90 transition-transform">
                        <i id="icon-${todo.id}" class="${icon}"></i>
                    </button>
                    <span id="text-${todo.id}" class="flex-1 ${text} cursor-pointer select-none" onclick="toggleTodo(${todo.id})">${todo.text}</span>
                    <button onclick="confirmDelete('todo', ${todo.id})" class="text-gray-300 hover:text-red-500 px-2 opacity-0 group-hover:opacity-100 transition-opacity focus:opacity-100">
                        <i class="fa-solid fa-trash-can"></i>
                    </button>
                </li>
            `;
        }
        function getEmptyTodoHTML() {
            return `<div id="empty-todo" class="text-center py-10 opacity-60"><i class="fa-solid fa-clipboard-check text-4xl text-gray-300 mb-2"></i><p class="text-sm">Sin tareas pendientes</p></div>`;
        }

        function addTodo() {
            const input = document.getElementById('new-todo');
            const text = input.value.trim();
            if (!text) return;
            const newTodo = { id: Date.now(), text, done: false };
            state.todos.unshift(newTodo);
            saveData();
            const list = document.getElementById('todo-list');
            const emptyMsg = document.getElementById('empty-todo');
            if(emptyMsg) emptyMsg.remove();
            list.insertAdjacentHTML('afterbegin', createTodoItemHTML(newTodo));
            input.value = '';
        }
        function toggleTodo(id) {
            const todo = state.todos.find(t => t.id === id);
            if (!todo) return;
            todo.done = !todo.done;
            saveData();
            const el = document.getElementById(`todo-${id}`);
            const icon = document.getElementById(`icon-${id}`);
            const text = document.getElementById(`text-${id}`);
            if (todo.done) {
                el.className = "flex items-center gap-3 p-4 rounded-xl shadow-sm border border-gray-100 bg-gray-50 transition-all group";
                icon.className = "fa-regular fa-square-check text-gray-400";
                text.className = "flex-1 text-gray-400 line-through cursor-pointer select-none";
            } else {
                el.className = "flex items-center gap-3 p-4 rounded-xl shadow-sm border border-gray-200 bg-white transition-all group";
                icon.className = "fa-regular fa-square text-pink-500 hover:text-pink-600";
                text.className = "flex-1 text-gray-700 font-medium cursor-pointer select-none";
            }
        }
        function deleteTodo(id) {
            state.todos = state.todos.filter(t => t.id !== id);
            saveData();
            const el = document.getElementById(`todo-${id}`);
            if (el) { el.classList.add('item-leave'); setTimeout(() => el.remove(), 300); }
            showToast("Tarea eliminada", "fa-trash");
        }

        // --- CALENDAR ---
        function getTurnarioHTML() {
            const year = state.currentDate.getFullYear();
            const month = state.currentDate.getMonth();
            const firstDay = new Date(year, month, 1);
            const lastDay = new Date(year, month + 1, 0);
            const daysInMonth = lastDay.getDate();
            const startingDay = firstDay.getDay() === 0 ? 6 : firstDay.getDay() - 1;
            const monthNames = ["Enero", "Febrero", "Marzo", "Abril", "Mayo", "Junio", "Julio", "Agosto", "Septiembre", "Octubre", "Noviembre", "Diciembre"];

            let html = `
                <div>
                    <div class="flex justify-between items-center mb-6 bg-white p-4 rounded-2xl shadow-sm border border-gray-100">
                        <button onclick="changeMonth(-1)" class="w-8 h-8 flex items-center justify-center text-pink-600 active:bg-gray-100 rounded-full"><i class="fa-solid fa-chevron-left"></i></button>
                        <h2 class="text-lg font-bold text-gray-800 capitalize">${monthNames[month]} <span class="text-pink-600">${year}</span></h2>
                        <button onclick="changeMonth(1)" class="w-8 h-8 flex items-center justify-center text-pink-600 active:bg-gray-100 rounded-full"><i class="fa-solid fa-chevron-right"></i></button>
                    </div>
                    <div class="grid grid-cols-7 gap-2 mb-2 text-center text-[10px] font-bold text-gray-400 uppercase tracking-widest">
                        <div>L</div><div>M</div><div>X</div><div>J</div><div>V</div><div>S</div><div>D</div>
                    </div>
                    <div id="calendar-grid" class="grid grid-cols-7 gap-1.5 sm:gap-2">
            `;
            for (let i = 0; i < startingDay; i++) html += `<div></div>`;
            for (let day = 1; day <= daysInMonth; day++) {
                const dateKey = `${year}-${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
                html += createDayCellHTML(dateKey, day);
            }
            html += `</div>
                <div class="mt-6 p-4 bg-white rounded-2xl shadow-sm border border-gray-100 text-xs text-gray-500 grid grid-cols-3 gap-2">
                    <span class="flex items-center gap-1.5"><span class="w-2 h-2 rounded-full bg-red-500"></span> Guardia</span>
                    <span class="flex items-center gap-1.5"><span class="w-2 h-2 rounded-full bg-blue-500"></span> D√≠a</span>
                    <span class="flex items-center gap-1.5"><span class="w-2 h-2 rounded-full bg-indigo-600"></span> Noche</span>
                    <span class="flex items-center gap-1.5"><span class="w-2 h-2 rounded-full bg-orange-300"></span> Post</span>
                    <span class="flex items-center gap-1.5"><span class="w-2 h-2 rounded-full bg-green-400"></span> Libre</span>
                </div>
            </div>`;
            return html;
        }

        function createDayCellHTML(dateKey, day) {
            const shift = state.shifts[dateKey];
            let bgClass = "bg-white border-gray-100 text-gray-600 hover:border-pink-200";
            let icon = "";
            if (shift) {
                if (shift.type === 'guardia') { bgClass = "bg-red-500 border-red-600 text-white shadow-md shadow-red-200"; icon = "üö®"; }
                else if (shift.type === 'dia') { bgClass = "bg-blue-500 border-blue-600 text-white shadow-md shadow-blue-200"; icon = "‚òÄÔ∏è"; }
                else if (shift.type === 'noche') { bgClass = "bg-indigo-600 border-indigo-700 text-white shadow-md shadow-indigo-200"; icon = "üåô"; }
                else if (shift.type === 'post') { bgClass = "bg-orange-100 border-orange-200 text-orange-700"; icon = "üí§"; }
                else if (shift.type === 'libre') { bgClass = "bg-green-100 border-green-200 text-green-700"; icon = "üåø"; }
            }
            const todayKey = new Date().toISOString().split('T')[0];
            const isToday = dateKey === todayKey ? "ring-2 ring-pink-500 ring-offset-1 z-10" : "";
            const hasNote = shift && shift.note ? `<div class="absolute top-1 right-1 w-1.5 h-1.5 bg-yellow-400 rounded-full shadow-sm"></div>` : "";

            return `
                <div id="day-${dateKey}" onclick="openShiftModal('${dateKey}')" class="relative calendar-day cursor-pointer rounded-xl border flex flex-col items-center justify-center transition-all active:scale-90 ${bgClass} ${isToday}">
                    ${hasNote}
                    <span class="text-sm font-bold ${shift && ['guardia','dia','noche'].includes(shift.type) ? 'text-white' : ''}">${day}</span>
                    ${shift && !['post','libre'].includes(shift.type) && !icon ? '' : `<span class="text-[10px] leading-none mt-0.5 opacity-80">${icon}</span>`}
                </div>
            `;
        }
        function changeMonth(delta) {
            state.currentDate.setMonth(state.currentDate.getMonth() + delta);
            renderView('turnario'); 
        }
        let selectedDateKey = null;
        let tempShiftType = null;
        function openShiftModal(dateKey) {
            selectedDateKey = dateKey;
            const shift = state.shifts[dateKey];
            const [y, m, d] = dateKey.split('-');
            const dateObj = new Date(y, m-1, d);
            const dateTitle = dateObj.toLocaleDateString('es-ES', { weekday: 'long', day: 'numeric', month: 'long' });
            
            document.getElementById('modal-date-title').innerText = dateTitle.charAt(0).toUpperCase() + dateTitle.slice(1);
            document.getElementById('modal-note-input').value = shift ? (shift.note || '') : '';
            tempShiftType = shift ? shift.type : null;
            updateShiftTypeUI();
            document.body.classList.add('modal-open');
            document.getElementById('shift-modal').classList.remove('hidden');
        }
        function setShiftType(type) { tempShiftType = type; updateShiftTypeUI(); }
        function updateShiftTypeUI() {
            document.querySelectorAll('.shift-type-btn').forEach(btn => {
                btn.classList.remove('ring-2', 'ring-pink-400', 'shadow-sm');
                if (String(tempShiftType) === btn.dataset.type) btn.classList.add('ring-2', 'ring-pink-400', 'shadow-sm');
            });
        }
        function closeModal() {
            document.body.classList.remove('modal-open');
            document.getElementById('shift-modal').classList.add('hidden');
        }
        function saveShift() {
            const note = document.getElementById('modal-note-input').value.trim();
            if (!tempShiftType && !note) delete state.shifts[selectedDateKey];
            else state.shifts[selectedDateKey] = { type: tempShiftType, note: note };
            saveData();
            closeModal();
            if (state.view === 'turnario') {
                const dayEl = document.getElementById(`day-${selectedDateKey}`);
                if(dayEl) { const [y, m, d] = selectedDateKey.split('-'); dayEl.outerHTML = createDayCellHTML(selectedDateKey, parseInt(d)); }
            } else if (state.view === 'dashboard') { renderView('dashboard'); }
            showToast("Guardado", "fa-check");
        }

        // --- NOTAS (CON CARPETAS Y EDICI√ìN) ---
        function getNotesHTML() {
            // Filtrado por carpeta
            let filteredNotes = state.notes;
            if (state.currentFolderId !== 'all') {
                filteredNotes = state.notes.filter(n => n.folderId === state.currentFolderId);
            }

            // Generar chips de carpetas
            const foldersHTML = `
                <div class="flex overflow-x-auto gap-2 pb-4 mb-2 no-scrollbar">
                    <button onclick="changeFolder('all')" class="whitespace-nowrap px-4 py-2 rounded-full text-sm font-bold transition-all ${state.currentFolderId === 'all' ? 'bg-gray-800 text-white shadow-md' : 'bg-white text-gray-500 border border-gray-200'}">
                        Todas
                    </button>
                    ${state.folders.map(f => `
                        <button onclick="changeFolder('${f.id}')" class="whitespace-nowrap px-4 py-2 rounded-full text-sm font-bold transition-all ${state.currentFolderId === f.id ? 'bg-pink-600 text-white shadow-md' : 'bg-white text-gray-500 border border-gray-200'}">
                            ${f.name}
                        </button>
                    `).join('')}
                    <button onclick="openFolderModal()" class="whitespace-nowrap px-3 py-2 rounded-full bg-gray-100 text-gray-600 hover:bg-gray-200 transition-colors">
                        <i class="fa-solid fa-plus"></i>
                    </button>
                </div>
            `;

            const notesListHTML = filteredNotes.length === 0 
                ? `<div class="text-center text-gray-400 text-sm mt-10 italic flex flex-col items-center"><i class="fa-regular fa-folder-open text-3xl mb-2 opacity-50"></i>Carpeta vac√≠a</div>` 
                : filteredNotes.map(n => createNoteHTML(n)).join('');

            // UI de Edici√≥n vs Creaci√≥n
            let editorTitle = "Nueva Nota";
            let btnText = "Guardar";
            let cancelBtn = "";
            let inputValue = "";
            let imgPreviewClass = "hidden";
            let imgPreviewSrc = "";

            if (state.editingNoteId) {
                const editingNote = state.notes.find(n => n.id === state.editingNoteId);
                if (editingNote) {
                    editorTitle = "Editando Nota";
                    btnText = "Actualizar";
                    inputValue = editingNote.text;
                    cancelBtn = `<button onclick="cancelEdit()" class="text-gray-400 hover:text-gray-600 text-sm mr-3">Cancelar</button>`;
                    if (editingNote.image) {
                        imgPreviewClass = "";
                        imgPreviewSrc = editingNote.image;
                    }
                }
            }

            // Nombre de carpeta actual para placeholder
            const currentFolderName = state.folders.find(f => f.id === state.currentFolderId)?.name || "General";
            const placeholder = state.currentFolderId === 'all' 
                ? "Nota nueva (se guardar√° en General)..." 
                : `Nota nueva en ${currentFolderName}...`;

            return `
                <div>
                    <h2 class="text-2xl font-bold text-gray-800 mb-2">Notas</h2>
                    ${foldersHTML}
                    
                    <div id="note-editor" class="bg-white p-4 rounded-2xl shadow-sm mb-6 border border-gray-100 transition-all ${state.editingNoteId ? 'ring-2 ring-pink-100' : ''}">
                        <div class="flex justify-between items-center mb-2">
                            <span class="text-xs font-bold text-gray-400 uppercase">${editorTitle}</span>
                            ${cancelBtn}
                        </div>
                        <textarea id="new-note-text" class="w-full p-2 border-b border-gray-100 focus:outline-none focus:border-pink-300 resize-none mb-2 font-handwriting text-lg bg-transparent" rows="3" placeholder="${placeholder}">${inputValue}</textarea>
                        
                        <div id="image-preview-container" class="${imgPreviewClass} mb-3 relative group w-fit">
                            <img id="image-preview" src="${imgPreviewSrc}" class="h-24 rounded-lg border border-gray-200 object-cover shadow-sm">
                            <button onclick="clearImageInput()" class="absolute -top-2 -right-2 bg-red-500 text-white rounded-full w-6 h-6 flex items-center justify-center transform scale-90"><i class="fa-solid fa-xmark text-xs"></i></button>
                        </div>

                        <div class="flex justify-between items-center mt-3">
                            <label class="cursor-pointer text-gray-500 hover:text-pink-600 flex items-center gap-2 text-xs font-bold">
                                <i class="fa-solid fa-camera"></i> Foto
                                <input type="file" id="new-note-image" accept="image/*" class="hidden">
                            </label>
                            <button onclick="saveNote()" class="bg-pink-600 text-white px-5 py-1.5 rounded-lg text-sm font-bold hover:bg-pink-700 transform active:scale-95 transition-transform shadow-md">${btnText}</button>
                        </div>
                    </div>
                    <div id="notes-list" class="grid grid-cols-1 gap-4 pb-20 masonry-layout">${notesListHTML}</div>
                </div>
            `;
        }

        function createNoteHTML(note) {
            const img = note.image ? `<img src="${note.image}" class="w-full h-auto rounded-lg mb-3 border border-black/5">` : '';
            // Buscar nombre de carpeta para mostrar un tag
            const folderName = state.folders.find(f => f.id === note.folderId)?.name || 'General';
            
            return `
                <div id="note-${note.id}" class="bg-yellow-50 p-5 rounded-xl shadow-sm border border-yellow-200/60 relative group item-enter hover:shadow-md transition-shadow">
                    ${img}
                    <p class="text-gray-800 whitespace-pre-wrap font-handwriting text-lg leading-relaxed">${note.text}</p>
                    <div class="flex justify-between items-center mt-4 pt-2 border-t border-yellow-200/50">
                        <span class="text-[10px] text-gray-400 bg-white/50 px-2 py-0.5 rounded-full">${folderName}</span>
                        <div class="flex gap-2">
                             <button onclick="copyNote(${note.id})" class="text-gray-400 hover:text-blue-500 bg-white rounded-full w-7 h-7 shadow-sm flex items-center justify-center transition-colors">
                                <i class="fa-solid fa-copy text-xs"></i>
                            </button>
                             <button onclick="startEditNote(${note.id})" class="text-gray-400 hover:text-pink-500 bg-white rounded-full w-7 h-7 shadow-sm flex items-center justify-center transition-colors">
                                <i class="fa-solid fa-pencil text-xs"></i>
                            </button>
                            <button onclick="confirmDelete('note', ${note.id})" class="text-red-300 hover:text-red-500 bg-white rounded-full w-7 h-7 shadow-sm flex items-center justify-center transition-colors">
                                <i class="fa-solid fa-trash-can text-xs"></i>
                            </button>
                        </div>
                    </div>
                </div>
            `;
        }
        
        function copyNote(id) {
            const note = state.notes.find(n => n.id === id);
            if(!note) return;
            
            const textarea = document.createElement('textarea');
            textarea.value = note.text;
            document.body.appendChild(textarea);
            textarea.select();
            try {
                document.execCommand('copy');
                showToast("Texto copiado", "fa-copy");
            } catch (e) {
                showToast("Error al copiar", "fa-times");
            }
            document.body.removeChild(textarea);
        }

        function changeFolder(folderId) {
            state.currentFolderId = folderId;
            renderView('notes');
        }

        function openFolderModal() {
            document.body.classList.add('modal-open');
            document.getElementById('folder-modal').classList.remove('hidden');
            document.getElementById('new-folder-name').focus();
        }
        function closeFolderModal() {
            document.body.classList.remove('modal-open');
            document.getElementById('folder-modal').classList.add('hidden');
            document.getElementById('new-folder-name').value = '';
        }

        function createFolder() {
            const name = document.getElementById('new-folder-name').value.trim();
            if (!name) return;
            const id = 'f_' + Date.now();
            state.folders.push({ id, name });
            state.currentFolderId = id; // Cambiar a la nueva carpeta
            saveData();
            closeFolderModal();
            renderView('notes');
            showToast(`Carpeta "${name}" creada`, "fa-folder-plus");
        }

        function startEditNote(id) {
            state.editingNoteId = id;
            renderView('notes'); // Re-render para mostrar modo edici√≥n
            // Scroll suave al editor
            setTimeout(() => {
                const editor = document.getElementById('note-editor');
                if(editor) {
                    editor.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    const input = document.getElementById('new-note-text');
                    if(input) input.focus();
                }
            }, 100);
        }

        function cancelEdit() {
            state.editingNoteId = null;
            renderView('notes');
        }

        async function saveNote() {
            const textInput = document.getElementById('new-note-text');
            const fileInput = document.getElementById('new-note-image');
            const imgPreview = document.getElementById('image-preview');
            
            const text = textInput.value.trim();
            const file = fileInput.files[0];

            if (!text && !file && imgPreview.classList.contains('hidden')) {
                return showToast("La nota est√° vac√≠a", "fa-pen");
            }

            // Procesar imagen nueva si existe
            let imageData = null;
            if (file) {
                try { imageData = await processImage(file); } 
                catch (e) { return showToast("Error al procesar imagen", "fa-times"); }
            } else if (!document.getElementById('image-preview-container').classList.contains('hidden')) {
                // Mantener imagen existente si estamos editando y no se subi√≥ una nueva
                imageData = imgPreview.src;
            }

            if (state.editingNoteId) {
                // ACTUALIZAR
                const noteIndex = state.notes.findIndex(n => n.id === state.editingNoteId);
                if (noteIndex > -1) {
                    state.notes[noteIndex].text = text;
                    state.notes[noteIndex].image = imageData;
                    // Mantener carpeta original o mover? Mejor mantener.
                    showToast("Nota actualizada", "fa-check");
                }
                state.editingNoteId = null;
            } else {
                // CREAR
                const targetFolder = state.currentFolderId === 'all' ? 'general' : state.currentFolderId;
                const newNote = { 
                    id: Date.now(), 
                    text, 
                    image: imageData,
                    folderId: targetFolder
                };
                state.notes.unshift(newNote);
                showToast("Nota guardada", "fa-check");
            }

            saveData();
            renderView('notes');
        }

        function deleteNote(id) {
            state.notes = state.notes.filter(n => n.id !== id);
            if (state.editingNoteId === id) {
                state.editingNoteId = null;
                // Limpiar editor si estaba activo en la nota borrada
                document.getElementById('new-note-text').value = '';
                document.getElementById('image-preview-container').classList.add('hidden');
            }
            saveData();
            
            const el = document.getElementById(`note-${id}`);
            if(el) { 
                el.classList.add('item-leave'); 
                setTimeout(() => el.remove(), 300); 
            }
            showToast("Nota eliminada", "fa-trash");
        }

        // --- LINKS ---
        function getLinksHTML() {
            const linksHTML = state.links.map(l => createLinkHTML(l)).join('');
            return `
                <div>
                    <h2 class="text-2xl font-bold text-gray-800 mb-4">Links</h2>
                    <div class="bg-white p-5 rounded-xl shadow-sm mb-6 border border-gray-100 flex flex-col gap-3">
                        <input type="text" id="link-title" placeholder="T√≠tulo" class="w-full p-2 border rounded-lg text-sm bg-gray-50 focus:bg-white focus:outline-none focus:ring-1 focus:ring-pink-500">
                        <input type="url" id="link-url" placeholder="URL" class="w-full p-2 border rounded-lg text-sm bg-gray-50 focus:bg-white focus:outline-none focus:ring-1 focus:ring-pink-500">
                        <button onclick="addLink()" class="bg-pink-600 text-white py-2 rounded-lg hover:bg-pink-700 font-bold shadow-sm mt-1">A√±adir</button>
                    </div>
                    <div id="links-list" class="space-y-3 pb-20">${linksHTML}</div>
                </div>
            `;
        }
        function createLinkHTML(link) {
            const favicon = `https://www.google.com/s2/favicons?domain=${link.url}&sz=64`;
            return `
                <div id="link-${link.id}" class="flex items-center bg-white p-3 rounded-xl shadow-sm border border-gray-100 hover:shadow-md transition item-enter">
                    <img src="${favicon}" class="w-10 h-10 rounded-lg bg-gray-50 p-1 mr-3 object-contain border border-gray-100" onerror="this.src='https://via.placeholder.com/32'">
                    <a href="${link.url}" target="_blank" class="flex-1 text-gray-700 font-bold truncate hover:text-pink-600 transition-colors">
                        ${link.title}
                        <div class="text-[10px] text-gray-400 font-normal truncate">${link.url}</div>
                    </a>
                    <button onclick="confirmDelete('link', ${link.id})" class="text-gray-300 hover:text-red-500 ml-2 px-3 py-2 rounded-lg hover:bg-red-50 transition-colors"><i class="fa-solid fa-trash-can"></i></button>
                </div>
            `;
        }
        function addLink() {
            const t = document.getElementById('link-title').value.trim();
            let u = document.getElementById('link-url').value.trim();
            if (!t || !u) return;
            if (!u.startsWith('http')) u = 'https://' + u;
            const newLink = { id: Date.now(), title: t, url: u };
            state.links.push(newLink);
            saveData();
            document.getElementById('links-list').insertAdjacentHTML('beforeend', createLinkHTML(newLink));
            document.getElementById('link-title').value = '';
            document.getElementById('link-url').value = '';
        }
        function deleteLink(id) {
            state.links = state.links.filter(l => l.id !== id);
            saveData();
            const el = document.getElementById(`link-${id}`);
            if(el) { el.classList.add('item-leave'); setTimeout(() => el.remove(), 300); }
        }

        // --- UTILS ---
        function processImage(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.readAsDataURL(file);
                reader.onload = (event) => {
                    const img = new Image();
                    img.src = event.target.result;
                    img.onload = () => {
                        const canvas = document.createElement('canvas');
                        const ctx = canvas.getContext('2d');
                        const MAX_WIDTH = 800;
                        let width = img.width;
                        let height = img.height;
                        if (width > MAX_WIDTH) { height *= MAX_WIDTH / width; width = MAX_WIDTH; }
                        canvas.width = width;
                        canvas.height = height;
                        ctx.drawImage(img, 0, 0, width, height);
                        resolve(canvas.toDataURL('image/jpeg', 0.6));
                    };
                    img.onerror = reject;
                };
                reader.onerror = reject;
            });
        }
        function previewImage(input) {
            if (input.files && input.files[0]) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const img = document.getElementById('image-preview');
                    if(img) {
                        img.src = e.target.result;
                        document.getElementById('image-preview-container').classList.remove('hidden');
                    }
                }
                reader.readAsDataURL(input.files[0]);
            }
        }
        function clearImageInput() {
            document.getElementById('new-note-image').value = '';
            document.getElementById('image-preview-container').classList.add('hidden');
            document.getElementById('image-preview').src = '';
        }

        // --- MODAL DELETE ---
        let itemToDelete = null;
        function confirmDelete(type, id) {
            itemToDelete = { type, id };
            const modal = document.getElementById('confirm-modal');
            const msg = document.getElementById('confirm-message');
            if(type === 'todo') msg.innerText = "¬øCompletar borrado?";
            document.body.classList.add('modal-open');
            modal.classList.remove('hidden');
            document.getElementById('confirm-btn-action').onclick = executeDelete;
        }
        function closeConfirmModal() {
            document.body.classList.remove('modal-open');
            document.getElementById('confirm-modal').classList.add('hidden');
            itemToDelete = null;
        }
        function executeDelete() {
            if (!itemToDelete) return;
            if (itemToDelete.type === 'todo') deleteTodo(itemToDelete.id);
            else if (itemToDelete.type === 'note') deleteNote(itemToDelete.id);
            else if (itemToDelete.type === 'link') deleteLink(itemToDelete.id);
            closeConfirmModal();
        }

        init();
    </script>
</body>
</html>
